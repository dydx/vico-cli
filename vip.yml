openapi: 3.0.0
info:
  title: VicoHome VIP/Subscription API
  description: API for VicoHome VIP/Subscription management
  version: 1.0.0

servers:
  - url: https://api-us.vicohome.io
    description: Production API server

paths:
  /vip/device/cloud/info:
    post:
      tags:
        - VIP Management
      summary: Query device cloud service VIP info
      description: Queries VIP/subscription information for a specific device
      operationId: getDeviceCloudInfo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SerialNoEntry'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceCloudServiceResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '404':
          description: Device not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /vip/tier/list/v4:
    get:
      tags:
        - VIP Management
      summary: Get subscription tier list
      description: Retrieves available subscription tier options and product information
      operationId: getTierListV4
      parameters:
        - name: app.apiVersion
          in: query
          required: false
          schema:
            type: string
          description: API version
        - name: app.appName
          in: query
          required: false
          schema:
            type: string
          description: Application name
        - name: app.appType
          in: query
          required: false
          schema:
            type: string
          description: Application type
        - name: app.bundle
          in: query
          required: false
          schema:
            type: string
          description: Bundle identifier
        - name: app.countlyId
          in: query
          required: false
          schema:
            type: string
          description: Analytics ID
        - name: app.env
          in: query
          required: false
          schema:
            type: string
          description: Environment (e.g., "prod")
        - name: app.tenantId
          in: query
          required: false
          schema:
            type: string
          description: Tenant identifier
        - name: app.timeZone
          in: query
          required: false
          schema:
            type: string
          description: User's timezone
        - name: app.version
          in: query
          required: false
          schema:
            type: string
          description: App version number
        - name: app.versionName
          in: query
          required: false
          schema:
            type: string
          description: App version name
        - name: countryNo
          in: query
          required: false
          schema:
            type: string
          description: Country code
        - name: language
          in: query
          required: false
          schema:
            type: string
          description: User's language preference
        - name: tenantId
          in: query
          required: false
          schema:
            type: string
          description: User's tenant ID
        - name: tierServiceType
          in: query
          required: false
          schema:
            type: integer
            enum: [1]
          description: Service type (1 = 4G service tiers)
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TierListResponseV4'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /vip/user/service/info:
    post:
      tags:
        - VIP Management
      summary: Get VIP user service info
      description: Gets VIP user service subscription information and device allocation
      operationId: getUserServiceInfo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/BaseEntry'
                - $ref: '#/components/schemas/Vip4GRequest'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VipServiceResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /vip/user/device/list:
    post:
      tags:
        - VIP Management
      summary: List devices with VIP status
      description: Lists devices with VIP status and their subscription tier positions
      operationId: getVipDeviceList
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BaseEntry'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VipManagerResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /vip/user/rolling/day:
    post:
      tags:
        - VIP Management
      summary: Update user rolling day
      description: Updates a user's subscription billing cycle day
      operationId: updateUserRollingDay
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RollingDayEntry'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /vip/available/purchase/device:
    post:
      tags:
        - VIP Management
      summary: Get purchasable devices
      description: Gets a list of devices available for purchase with a specific subscription plan
      operationId: getPurchaseDevice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductEntry'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurchaseDeviceResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
                
  /user/queryFreeTier:
    post:
      tags:
        - VIP Management
      summary: Query free tier status
      description: Queries the user's free cloud storage tier status and limits
      operationId: queryFreeTier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BaseEntry'
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FreeTierResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'

components:
  schemas:
    BaseEntry:
      type: object
      properties:
        app:
          type: object
          properties:
            type:
              type: string
              description: Application type identifier
              example: "android"
            version:
              type: string
              description: Application version
              example: "1.2.3"
          required:
            - type
            - version
        countryNo:
          type: string
          description: User's country code
          example: "US"
        language:
          type: string
          description: User's language preference
          example: "en"
        tenantId:
          type: string
          description: User's tenant ID
          example: "default"
      required:
        - app
        
    BaseResponse:
      type: object
      properties:
        code:
          type: string
          description: Response code
          example: "0"
        msg:
          type: string
          description: Response message
          example: "Success"
      required:
        - code
        
    SerialNoEntry:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseEntry'
        - type: object
          properties:
            serialNumber:
              type: string
              description: The device's serial number
              example: "AB1234567"
          required:
            - serialNumber
            
    DeviceCloudServiceResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                endTime:
                  type: integer
                  format: int64
                  description: Subscription end time (Unix timestamp in seconds)
                  example: 1672531200
                freeLicenseId:
                  type: integer
                  description: Free license ID (if applicable)
                  example: 0
                hasVip:
                  type: boolean
                  description: Whether the device has an active VIP subscription
                  example: true
                tierList:
                  type: array
                  description: List of tiers/subscription options
                  items:
                    $ref: '#/components/schemas/SubscriptionTier'
                tierNameKey:
                  type: string
                  description: Name key of the subscription tier
                  example: "premium_tier"
                vipNotifyShow:
                  type: boolean
                  description: Whether to show VIP notifications
                  example: true
                vipTag:
                  type: integer
                  description: VIP tag value used to identify subscription type
                  example: 1
                  
    SubscriptionTier:
      type: object
      description: Subscription tier information
      properties:
        id:
          type: integer
          description: Tier ID
          example: 1
        name:
          type: string
          description: Tier name
          example: "Premium"
        features:
          type: array
          description: Features included in this tier
          items:
            type: string
          example: ["Cloud Storage", "AI Detection"]
          
    TierProduct:
      type: object
      description: Product information for a subscription tier
      properties:
        dayLookBack:
          type: integer
          description: Days of recording history available
          example: 30
        deviceNum:
          type: integer
          description: Number of devices included
          example: 1
        localBillingCycleDuration:
          type: integer
          description: Billing cycle duration
          example: 1
        localBillingCycleType:
          type: integer
          description: Billing cycle type (1=day, 2=month, 3=year)
          enum: [1, 2, 3]
          example: 2
        maxDeviceNum:
          type: integer
          description: Maximum devices allowed
          example: 1
        productId:
          type: integer
          description: Product ID
          example: 12345
        showInTier:
          type: boolean
          description: Whether shown in tier selection
          example: true
        subscriptionGroupId:
          type: string
          description: Subscription group
          example: "group_id"
        tierId:
          type: integer
          description: Tier ID
          example: 2
        currency:
          type: string
          description: Currency symbol
          example: "$"
        currentPrice:
          type: string
          description: Current price as string
          example: "9.99"
        priceMicro:
          type: integer
          format: int64
          description: Price in micro units (millionths)
          example: 9990000
        productName:
          type: string
          description: Product name
          example: "Cloud Standard"
        savePercentOfMontly:
          type: integer
          description: Percent saved vs monthly
          example: 0
        tierLevel:
          type: string
          description: Tier level
          example: "standard"
          
    FeatureDiff:
      type: object
      description: Feature difference between tiers
      properties:
        title:
          type: string
          description: Feature name
          example: "Video History"
        type:
          type: string
          description: Feature type
          example: "days"
        value:
          type: string
          description: Free tier value
          example: "1 day"
        vipValue:
          type: string
          description: Paid tier value
          example: "30 days"
          
    CopywriteDiff:
      type: object
      description: Feature comparison information
      properties:
        diffList:
          type: array
          description: Feature differences between tiers
          items:
            $ref: '#/components/schemas/FeatureDiff'
        isSubscribed:
          type: boolean
          description: Whether user is subscribed
          example: false
        storageDayCount:
          type: integer
          description: Storage days in free tier
          example: 1
        vipType:
          type: string
          description: Current VIP level
          example: "none"
          
    TierList:
      type: object
      description: Tier list with different pricing options
      properties:
        tierV1List:
          type: object
          description: Old tier structure (for backward compatibility)
          properties:
            monthlyProductList:
              type: array
              items:
                $ref: '#/components/schemas/TierProduct'
            yearlyProductList:
              type: array
              items:
                $ref: '#/components/schemas/TierProduct'
        tierV2List:
          type: object
          description: Current tier structure
          properties:
            monthlyProductList:
              type: array
              description: Monthly subscription options
              items:
                $ref: '#/components/schemas/TierProduct'
            yearlyProductList:
              type: array
              description: Yearly subscription options
              items:
                $ref: '#/components/schemas/TierProduct'
          
    TierListResponseV4:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                cloudFreeTrialDay:
                  type: integer
                  description: Free trial duration in days
                  example: 30
                commendProduct:
                  type: array
                  description: Recommended regular products
                  items:
                    $ref: '#/components/schemas/TierProduct'
                commendProduct4G:
                  type: array
                  description: Recommended 4G products
                  items:
                    $ref: '#/components/schemas/TierProduct'
                commendProduct4GHalfYearList:
                  type: array
                  description: 6-month 4G products
                  items:
                    $ref: '#/components/schemas/TierProduct'
                commendProduct4GYearList:
                  type: array
                  description: Annual 4G products
                  items:
                    $ref: '#/components/schemas/TierProduct'
                copywriteDiff:
                  $ref: '#/components/schemas/CopywriteDiff'
                hasBirdDevice:
                  type: boolean
                  description: Whether user has bird devices
                  example: false
                productExplain:
                  type: array
                  description: Explanatory text for products
                  items:
                    type: string
                  example: ["All prices include applicable taxes"]
                tierList:
                  $ref: '#/components/schemas/TierList'
                tierReceive:
                  type: boolean
                  description: Whether tier data was received
                  example: true
                tierReceive4G:
                  type: boolean
                  description: Whether 4G tier data was received
                  example: true
                  
    Vip4GRequest:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseEntry'
        - type: object
          properties:
            tierServiceType:
              type: integer
              description: Service type (1 = 4G service tiers)
              enum: [1]
              example: 1
              
    VipDevice:
      type: object
      description: Device information with VIP status
      properties:
        deviceId:
          type: string
          description: Device identifier
          example: "5f7a8b9c1d2e3f4a"
        serialNumber:
          type: string
          description: Device serial number
          example: "AB1234567"
        deviceName:
          type: string
          description: Device name
          example: "Front Door Camera"
        deviceType:
          type: string
          description: Device type
          example: "doorbell"
        imageUrl:
          type: string
          description: Device image URL
          example: "https://storage.vicohome.io/images/device/AB1234567.jpg"
        isAdmin:
          type: boolean
          description: Whether user is admin for this device
          example: true
          
    AdditionalService:
      type: object
      description: Additional service information
      properties:
        name:
          type: string
          description: Service name
          example: "Extended Storage"
        description:
          type: string
          description: Service description
          example: "Additional cloud storage capacity"
          
    TierFeatureDescription:
      type: object
      description: Feature description for a subscription tier
      properties:
        title:
          type: string
          description: Feature title
          example: "Smart Detection"
        type:
          type: string
          description: Feature type
          example: "boolean"
        value:
          type: string
          description: Feature value
          example: "true"
          
    ActiveServiceDetails:
      type: object
      description: Details of currently active VIP service
      properties:
        activeDeviceList:
          type: array
          description: Devices active on this tier
          items:
            $ref: '#/components/schemas/VipDevice'
        tierNameKey:
          type: string
          description: Key for tier name localization
          example: "tier_premium"
        endTime:
          type: integer
          format: int64
          description: Subscription end time (milliseconds since epoch)
          example: 1648825200000
        maxDeviceNum:
          type: integer
          description: Maximum devices allowed
          example: 5
        tierId:
          type: integer
          description: Tier ID
          example: 3
        billingCycleType:
          type: integer
          description: Billing cycle type (1=day, 2=month, 3=year)
          enum: [1, 2, 3]
          example: 2
        billingCycleDuration:
          type: integer
          description: Billing cycle duration
          example: 1
          
    VipServiceResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                notInTierDeviceList:
                  type: array
                  description: Devices not included in the tier
                  items:
                    $ref: '#/components/schemas/VipDevice'
                notInTierDeviceThirdPartyList:
                  type: array
                  description: Third-party devices not in tier
                  items:
                    $ref: '#/components/schemas/VipDevice'
                outOfPlanKey:
                  type: string
                  description: Out-of-plan message key
                  example: "out_of_plan_warning"
                rollingDay:
                  type: integer
                  description: Billing day of month
                  example: 15
                serviceActiveDevice:
                  $ref: '#/components/schemas/ActiveServiceDetails'
                serviceAdditionList:
                  type: array
                  description: Additional services on subscription
                  items:
                    $ref: '#/components/schemas/AdditionalService'
                supportRollingDay:
                  type: array
                  description: Available billing day options
                  items:
                    type: integer
                  example: [1, 5, 10, 15, 20, 25]
                tierDescribeList:
                  type: array
                  description: Feature descriptions for tier
                  items:
                    $ref: '#/components/schemas/TierFeatureDescription'
                userVipId:
                  type: integer
                  description: User VIP identifier
                  example: 12345
                  
    VipDeviceDetails:
      type: object
      description: Detailed device information with VIP status
      properties:
        serialNumber:
          type: string
          description: Device serial number
          example: "AB1234567"
        deviceName:
          type: string
          description: Device name
          example: "Front Door Camera"
        deviceStatus:
          type: integer
          description: Device status code
          example: 1
        online:
          type: integer
          description: Online status (1=online, 0=offline)
          enum: [0, 1]
          example: 1
        icon:
          type: string
          description: Device icon URL
          example: "https://example.com/icon.png"
        tierName:
          type: string
          description: Tier name device belongs to
          example: "Premium"
        isAdmin:
          type: boolean
          description: Whether user is admin for this device
          example: true
        deviceType:
          type: string
          description: Device type identifier
          example: "doorbell"
        deviceStorageType:
          type: integer
          description: Storage type for device (cloud vs local)
          example: 1
          
    VipManagerTier:
      type: object
      description: Subscription tier information with associated devices
      properties:
        tierId:
          type: integer
          description: Tier ID
          example: 3
        tierName:
          type: string
          description: Tier name
          example: "Premium"
        tierNameKey:
          type: string
          description: Tier name localization key
          example: "premium"
        maxDeviceNum:
          type: integer
          description: Maximum devices allowed in tier
          example: 5
        activeDeviceList:
          type: array
          description: Devices in this tier
          items:
            $ref: '#/components/schemas/VipDeviceDetails'
        supportDeviceSnList:
          type: array
          description: List of supported device serial numbers
          items:
            type: string
          example: ["AB1234567", "CD7654321"]
        customSupportAllDevice:
          type: boolean
          description: Whether all devices are supported
          example: false
          
    VipManagerResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: array
              description: List of VIP manager tiers
              items:
                $ref: '#/components/schemas/VipManagerTier'
                
    RollingDayEntry:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseEntry'
        - type: object
          properties:
            rollingDay:
              type: integer
              description: The day of month to set as billing day (1-31)
              minimum: 1
              maximum: 31
              example: 15
            userVipId:
              type: integer
              description: The user's VIP subscription ID
              example: 12345
          required:
            - rollingDay
            - userVipId
    
    ProductEntry:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseEntry'
        - type: object
          properties:
            productId:
              type: integer
              description: The subscription product ID to query
              example: 12345
          required:
            - productId
            
    PurchaseDeviceItem:
      type: object
      description: Information about a device available for purchase
      properties:
        canChoose:
          type: boolean
          description: Whether the device can be selected
          example: true
        deviceName:
          type: string
          description: Device name
          example: "Front Door Camera"
        icon:
          type: string
          description: Device icon URL
          example: "https://example.com/icon.png"
        isCheckout:
          type: boolean
          description: Whether device is pre-selected
          example: true
        serialNumber:
          type: string
          description: Device serial number
          example: "ABCD1234"
        deviceType:
          type: string
          description: Device type identifier
          example: "doorbell"
            
    PurchaseDeviceResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                allSimThirdParty:
                  type: boolean
                  description: Whether all devices are sim third-party devices
                  example: false
                availableForPurchase:
                  type: boolean
                  description: Whether any devices are available for purchase
                  example: true
                deviceList:
                  type: array
                  description: List of devices available for selection
                  items:
                    $ref: '#/components/schemas/PurchaseDeviceItem'
                    
    FreeTierResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/BaseResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                effectTime:
                  type: integer
                  format: int64
                  description: Unix timestamp when free tier began
                  example: 1639036800
                endTime:
                  type: integer
                  format: int64
                  description: Unix timestamp when free tier expires
                  example: 1670572800
                rollingDays:
                  type: integer
                  description: Number of days recordings are kept
                  example: 7
                storage:
                  type: integer
                  format: int64
                  description: Storage space in bytes
                  example: 1073741824
                valid:
                  type: boolean
                  description: Whether the free tier is currently valid
                  example: true